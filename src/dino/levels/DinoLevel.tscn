[gd_scene load_steps=26 format=3 uid="uid://7rx6q0i5fbdo"]

[ext_resource type="Script" path="res://src/dino/levels/DinoLevel.gd" id="1_thmin"]
[ext_resource type="Script" path="res://src/dino/levels/LevelDef.gd" id="2_mkgpx"]
[ext_resource type="Script" path="res://addons/phantom_camera/scripts/phantom_camera_host/phantom_camera_host.gd" id="4_um1rd"]
[ext_resource type="Script" path="res://addons/core/quest/QuestManager.gd" id="5_kkaoh"]
[ext_resource type="PackedScene" uid="uid://w6sbcbxo5mnt" path="res://src/dino/pickups/coins/ShrineGem.tscn" id="7_4on4m"]
[ext_resource type="Script" path="res://src/dino/pickups/coins/ShrineGem.gd" id="8_a88cx"]
[ext_resource type="PackedScene" uid="uid://caq6muu5og6oo" path="res://src/dino/enemies/blobs/BlobWalker.tscn" id="9_42flh"]
[ext_resource type="Script" path="res://addons/core/brick/BrickRoom.gd" id="9_mbvbi"]
[ext_resource type="Script" path="res://src/dino/enemies/TDEnemy.gd" id="10_oem40"]
[ext_resource type="PackedScene" uid="uid://bs0c5xn0vglfn" path="res://src/dino/entities/PlayerSpawnPoint.tscn" id="12_3kpot"]
[ext_resource type="Script" path="res://src/dino/entities/PlayerSpawnPoint.gd" id="13_2xn2h"]
[ext_resource type="PackedScene" uid="uid://g1xpunfo7e1u" path="res://addons/core/reptile/tilemaps/topdown/TDCavePitTiles16.tscn" id="16_v5h6o"]
[ext_resource type="TileSet" uid="uid://co3os0t7u2nbl" path="res://addons/core/reptile/tilesets/topdown/TDCavePitTileSet16.tres" id="17_rsior"]
[ext_resource type="Script" path="res://addons/core/reptile/tilemaps/topdown/PitTiles.gd" id="18_dpft4"]
[ext_resource type="PackedScene" uid="uid://c8yo06n5gm2ax" path="res://addons/core/reptile/tilemaps/CaveTiles16.tscn" id="18_she2h"]
[ext_resource type="TileSet" uid="uid://b0rg8dver31j6" path="res://addons/core/reptile/tilesets/CaveTiles16.tres" id="19_arqxp"]
[ext_resource type="Script" path="res://addons/core/reptile/RepTileMap.gd" id="20_jlqf0"]
[ext_resource type="PackedScene" uid="uid://cosk30larse70" path="res://addons/core/reptile/tilemaps/topdown/TDCaveFloorTiles16.tscn" id="21_7r0c5"]
[ext_resource type="TileSet" uid="uid://busrg4na2qqk5" path="res://addons/core/reptile/tilesets/topdown/TDCaveFloorTileSet16.tres" id="22_fpsvv"]

[sub_resource type="Resource" id="Resource_w68ge"]
script = ExtResource("2_mkgpx")
_id = "206"

[sub_resource type="GDScript" id="GDScript_jxoqe"]
script/source = "@tool
extends BrickLevelGen

## get room opts #########################################

# TODO test setup, maybe testing specific seeds?
func get_room_opts(_opts):
	var default_room_opt = {skip_flags=[\"first\"]}

	var initial_rooms = [
		{flags=[\"first\"]},
		{skip_flags=[\"first\"],
			# TODO maybe better as 'extend_side' or 'direction'
			side=Vector2.RIGHT},
		]

	var agg = range(room_count - len(initial_rooms) - 1).reduce(func(acc, _i):
		var next_room_opt = default_room_opt.duplicate(true)

		var side_opts = [
			Vector2.UP, Vector2.DOWN, Vector2.RIGHT, Vector2.LEFT
			].filter(func(s): return s != acc.last_side)
		next_room_opt[\"side\"] = U.rand_of(side_opts)

		acc.room_opts.append(next_room_opt)
		acc.last_side = next_room_opt.side

		return acc, {room_opts=initial_rooms, last_side=Vector2.RIGHT})

	for opt in agg.room_opts:
		opt.merge({
			label_to_tilemap={\"Tile\": {
				scene=load(\"res://addons/core/reptile/tilemaps/CaveTiles16.tscn\"),
				add_borders=true
				},
				\"Floor\":{
					scene=load(\"res://addons/core/reptile/tilemaps/topdown/TDCaveFloorTiles16.tscn\")
					},
				\"Pit\":{
					scene=load(\"res://addons/core/reptile/tilemaps/topdown/TDCavePitTiles16.tscn\")
					}
				},
			label_to_entity={
				\"Player\": {scene=load(\"res://src/dino/entities/PlayerSpawnPoint.tscn\")},
				\"Chaser\": {scene=load(\"res://src/dino/enemies/blobs/BlobChaser.tscn\")},
				\"Walker\": {scene=load(\"res://src/dino/enemies/blobs/BlobWalker.tscn\")},
				\"Gem\": {scene=load(\"res://src/dino/pickups/coins/ShrineGem.tscn\")},
				}})

	return agg.room_opts
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_fx2qk"]
size = Vector2(112, 96)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_ruj06"]
size = Vector2(112, 112)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_lrssy"]
size = Vector2(112, 112)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_360jx"]
size = Vector2(112, 112)

[node name="DinoLevel" type="Node2D"]
script = ExtResource("1_thmin")
genre_type = 1
level_def = SubResource("Resource_w68ge")

[node name="LevelGen" type="Node2D" parent="." groups=["brick_generators"]]
script = SubResource("GDScript_jxoqe")

[node name="Camera2D" type="Camera2D" parent="."]

[node name="PhantomCameraHost" type="Node" parent="Camera2D"]
script = ExtResource("4_um1rd")

[node name="QuestManager" type="Node" parent="."]
script = ExtResource("5_kkaoh")

[node name="Entities" type="Node2D" parent="."]

[node name="PlayerSpawnPoint" type="Marker2D" parent="Entities" groups=["player_spawn_points"] instance=ExtResource("12_3kpot")]
position = Vector2(48, 32)
script = ExtResource("13_2xn2h")
dev_only = false

[node name="ShrineGem" type="Node2D" parent="Entities" groups=["gems"] instance=ExtResource("7_4on4m")]
position = Vector2(160, 48)
script = ExtResource("8_a88cx")

[node name="BlobWalker" type="CharacterBody2D" parent="Entities" groups=["enemies"] instance=ExtResource("9_42flh")]
position = Vector2(176, 64)
collision_layer = 8
collision_mask = 5127
script = ExtResource("10_oem40")
display_name = "Blob Walker"
initial_health = 2
should_wander = true

[node name="@Node2D@23759" type="Node2D" parent="Entities" groups=["gems"] instance=ExtResource("7_4on4m")]
position = Vector2(144, -64)
script = ExtResource("8_a88cx")

[node name="@CharacterBody2D@23760" type="CharacterBody2D" parent="Entities" groups=["enemies"] instance=ExtResource("9_42flh")]
position = Vector2(176, -48)
collision_layer = 8
collision_mask = 5127
script = ExtResource("10_oem40")
display_name = "Blob Walker"
initial_health = 2
should_wander = true

[node name="@Node2D@23761" type="Node2D" parent="Entities" groups=["gems"] instance=ExtResource("7_4on4m")]
position = Vector2(272, -64)
script = ExtResource("8_a88cx")

[node name="@CharacterBody2D@23762" type="CharacterBody2D" parent="Entities" groups=["enemies"] instance=ExtResource("9_42flh")]
position = Vector2(288, -48)
collision_layer = 8
collision_mask = 5127
script = ExtResource("10_oem40")
display_name = "Blob Walker"
initial_health = 2
should_wander = true

[node name="Tilemaps" type="Node2D" parent="."]

[node name="CaveTiles16" type="TileMap" parent="Tilemaps" instance=ExtResource("18_she2h")]
tile_set = ExtResource("19_arqxp")
format = 2
layer_0/tile_data = PackedInt32Array(-65515, 196608, 2, -131051, 524288, 3, -196587, 262144, 2, -262123, 262144, 2, -327659, 262144, 2, -393195, 524288, 2, -458731, 196608, 2, -524267, 196608, 1, -524275, 131072, 1, 20, 131072, 3, 19, 458752, 4, 18, 131072, 4, 17, 131072, 4, 16, 131072, 4, 15, 393216, 4, 14, 393216, 2, -524268, 131072, 1, -524269, 458752, 1, -524270, 131072, 4, -524271, 131072, 4, -524272, 131072, 4, -524273, 393216, 1, -524274, 131072, 1, 21, 196608, 3, -65530, 458752, 3, -131066, 327680, 3, -196602, 262144, 2, -262138, 262144, 2, -327674, 327680, 2, -393210, 65536, 2, -458746, 65536, 2, -524282, 65536, 1, -524276, 458752, 1, -524277, 131072, 4, -524278, 131072, 4, -524279, 393216, 1, -524280, 131072, 1, -524281, 131072, 1, 393230, 196608, 2, 327694, 524288, 3, 262158, 262144, 2, 196622, 262144, 2, 131086, 262144, 2, 65550, 524288, 2, 393222, 458752, 2, 458765, 131072, 3, 458764, 458752, 4, 458763, 131072, 4, 458762, 131072, 4, 458761, 131072, 4, 458760, 393216, 4, 458759, 131072, 3, 458758, 65536, 3, 458766, 196608, 3, 393215, 65536, 2, 327679, 65536, 2, 262143, 65536, 2, 196607, 65536, 2, 131071, 65536, 2, 65535, 65536, 2, -1, 65536, 1, 393221, 131072, 3, 393220, 131072, 3, 393219, 131072, 3, 393218, 131072, 3, 393217, 131072, 3, 393216, 131072, 3, 458751, 65536, 3, -65531, 131072, 1, -65532, 131072, 1, -65533, 131072, 1, -65534, 131072, 1, -65535, 131072, 1, -65536, 131072, 1, -458738, 131072, 2, -458737, 196608, 2, -458733, 65536, 2, -458732, 131072, 2, -393202, 131072, 3, -393201, 196608, 3, -393197, 65536, 3, -393196, 131072, 3, -131058, 131072, 1, -131057, 196608, 1, -131053, 65536, 1, -131052, 131072, 1, -65522, 131072, 2, -65521, 196608, 2, -65517, 65536, 2, -65516, 131072, 2, -458745, 131072, 2, -458744, 131072, 2, -458743, 196608, 2, -458740, 65536, 2, -458739, 131072, 2, -393209, 131072, 2, -393208, 393216, 2, -393207, 196608, 3, -393204, 65536, 2, -393203, 393216, 2, -327673, 131072, 3, -327672, 196608, 3, -327668, 65536, 3, -327667, 196608, 3, -131065, 131072, 1, -131064, 196608, 1, -131060, 65536, 1, -131059, 131072, 1, -65529, 131072, 2, -65528, 196608, 2, -65524, 65536, 2, -65523, 131072, 2, 7, 458752, 2, 8, 196608, 2, 12, 65536, 2, 13, 131072, 2, 65543, 65536, 3, 65544, 196608, 3, 65548, 65536, 3, 65549, 131072, 3, 327687, 131072, 1, 327688, 196608, 1, 327692, 65536, 1, 327693, 131072, 1, 393223, 131072, 2, 393224, 196608, 2, 393228, 65536, 2, 393229, 131072, 2, 0, 393216, 2, 1, 131072, 3, 2, 131072, 3, 3, 131072, 3, 4, 131072, 3, 5, 131072, 3, 6, 131072, 3, 65536, 196608, 2, 131072, 196608, 2, 196608, 196608, 2, 262144, 196608, 2, 327680, 393216, 3, 327681, 131072, 1, 327682, 131072, 1, 327683, 131072, 1, 327684, 131072, 1, 327685, 131072, 1, 327686, 131072, 1)
script = ExtResource("20_jlqf0")

[node name="TDCaveFloorTiles16" type="TileMap" parent="Tilemaps" instance=ExtResource("21_7r0c5")]
tile_set = ExtResource("22_fpsvv")
format = 2
layer_0/tile_data = PackedInt32Array(-458736, 65536, 1, -458735, 131072, 1, -458734, 196608, 1, -393200, 65536, 2, -393199, 131072, 2, -393198, 196608, 2, -327666, 65536, 1, -327665, 131072, 1, -327664, 458752, 3, -327663, 131072, 2, -327662, 393216, 3, -327661, 131072, 1, -327660, 196608, 1, -262130, 458752, 3, -262129, 131072, 2, -262128, 131072, 2, -262127, 131072, 2, -262126, 131072, 2, -262125, 131072, 2, -262124, 196608, 2, -196594, 131072, 3, -196593, 131072, 3, -196592, 458752, 2, -196591, 131072, 2, -196590, 393216, 2, -196589, 131072, 3, -196588, 196608, 3, -131056, 65536, 2, -131055, 131072, 2, -131054, 196608, 2, -65520, 65536, 3, -65519, 131072, 3, -65518, 196608, 3, -458742, 65536, 1, -458741, 196608, 1, -393206, 65536, 2, -393205, 196608, 2, -327671, 65536, 1, -327670, 458752, 3, -327669, 196608, 2, -262137, 65536, 1, -262136, 131072, 1, -262135, 458752, 3, -262134, 131072, 2, -262133, 393216, 3, -262132, 131072, 1, -262131, 131072, 1, -196601, 65536, 3, -196600, 131072, 3, -196599, 458752, 2, -196598, 131072, 2, -196597, 393216, 2, -196596, 131072, 3, -196595, 131072, 3, -131063, 65536, 2, -131062, 131072, 2, -131061, 196608, 2, -65527, 65536, 2, -65526, 131072, 2, -65525, 196608, 2, 9, 65536, 2, 10, 131072, 2, 11, 196608, 2, 65545, 65536, 2, 65546, 131072, 2, 65547, 196608, 2, 131079, 131072, 1, 131080, 131072, 1, 131081, 458752, 3, 131082, 131072, 2, 131083, 393216, 3, 131084, 131072, 1, 131085, 196608, 1, 196615, 131072, 2, 196616, 131072, 2, 196617, 131072, 2, 196618, 131072, 2, 196619, 131072, 2, 196620, 131072, 2, 196621, 196608, 2, 262151, 131072, 3, 262152, 131072, 3, 262153, 458752, 2, 262154, 131072, 2, 262155, 393216, 2, 262156, 131072, 3, 262157, 196608, 3, 327689, 65536, 2, 327690, 131072, 2, 327691, 196608, 2, 393225, 65536, 3, 393226, 131072, 3, 393227, 196608, 3, 65537, 65536, 1, 65538, 131072, 1, 65539, 131072, 1, 65540, 131072, 1, 65541, 131072, 1, 65542, 196608, 1, 131073, 65536, 2, 131074, 131072, 2, 131075, 131072, 2, 131076, 131072, 2, 131077, 131072, 2, 131078, 393216, 3, 196609, 65536, 2, 196610, 131072, 2, 196611, 131072, 2, 196612, 131072, 2, 196613, 131072, 2, 196614, 131072, 2, 262145, 65536, 3, 262146, 131072, 3, 262147, 131072, 3, 262148, 131072, 3, 262149, 131072, 3, 262150, 131072, 3)

[node name="TDCavePitTiles16" type="TileMap" parent="Tilemaps" groups=["pits"] instance=ExtResource("16_v5h6o")]
tile_set = ExtResource("17_rsior")
format = 2
script = ExtResource("18_dpft4")

[node name="Rooms" type="Node2D" parent="."]

[node name="Room_0" type="Node2D" parent="Rooms"]
script = ExtResource("9_mbvbi")

[node name="ColorRect" type="ColorRect" parent="Rooms/Room_0"]
visible = false
offset_right = 112.0
offset_bottom = 96.0
color = Color(0.803922, 0.521569, 0.247059, 1)

[node name="RoomBox" type="Area2D" parent="Rooms/Room_0" groups=["roombox"]]
visible = false
collision_layer = 0
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="Rooms/Room_0/RoomBox"]
position = Vector2(56, 48)
shape = SubResource("RectangleShape2D_fx2qk")

[node name="Room_1" type="Node2D" parent="Rooms"]
position = Vector2(112, 0)
script = ExtResource("9_mbvbi")

[node name="ColorRect" type="ColorRect" parent="Rooms/Room_1"]
visible = false
offset_right = 112.0
offset_bottom = 112.0
color = Color(0.803922, 0.521569, 0.247059, 1)

[node name="RoomBox" type="Area2D" parent="Rooms/Room_1" groups=["roombox"]]
visible = false
collision_layer = 0
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="Rooms/Room_1/RoomBox"]
position = Vector2(56, 56)
shape = SubResource("RectangleShape2D_ruj06")

[node name="Room_2" type="Node2D" parent="Rooms"]
position = Vector2(112, -112)
script = ExtResource("9_mbvbi")

[node name="ColorRect" type="ColorRect" parent="Rooms/Room_2"]
visible = false
offset_right = 112.0
offset_bottom = 112.0
color = Color(0.803922, 0.521569, 0.247059, 1)

[node name="RoomBox" type="Area2D" parent="Rooms/Room_2" groups=["roombox"]]
visible = false
collision_layer = 0
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="Rooms/Room_2/RoomBox"]
position = Vector2(56, 56)
shape = SubResource("RectangleShape2D_lrssy")

[node name="Room_3" type="Node2D" parent="Rooms"]
position = Vector2(224, -112)
script = ExtResource("9_mbvbi")

[node name="ColorRect" type="ColorRect" parent="Rooms/Room_3"]
visible = false
offset_right = 112.0
offset_bottom = 112.0
color = Color(0.803922, 0.521569, 0.247059, 1)

[node name="RoomBox" type="Area2D" parent="Rooms/Room_3" groups=["roombox"]]
visible = false
collision_layer = 0
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="Rooms/Room_3/RoomBox"]
position = Vector2(56, 56)
shape = SubResource("RectangleShape2D_360jx")
